## USER STORY: Productversie Wijziging

Als magazijnmedewerker  
Wil ik de productversie van een geregistreerd apparaat kunnen wijzigen
Zodat ik verkeerd geclassificeerde items kan corrigeren terwijl dezelfde identifiers behouden blijven

### acceptatiecriteria

### productversie wijziging functionaliteit
- [ ] "Productversie Wijzigen" functie toegankelijk vanuit identifier detailpagina
- [ ] Gebruikersinterface voor productversie wijziging met velden:
  - Huidige Productversie (alleen-lezen)
  - Nieuwe Productversie (dropdown, verplicht)
  - Optioneel notitie veld voor reden van wijziging

### validatie regels
- [ ] Nieuwe productversie kan niet identiek zijn aan huidige versie
- [ ] Nieuwe productversie moet actief zijn in het systeem
- [ ] Nieuwe productversie tracking modus moet compatibel zijn:
  - Als huidige versie IMEI heeft, moet nieuwe versie IMEI tracking ondersteunen
  - Als huidige versie Serienummer heeft, moet nieuwe versie Serienummer tracking ondersteunen
  - Voorkom swaps die bestaande identifiers ongeldig zouden maken

### compatibiliteits matrix
- [ ] Geen → IMEI of Serienummer (geen beperkingen)
- [ ] IMEI → Alleen IMEI (moet IMEI ondersteunen)
- [ ] Serienummer → Alleen Serienummer (moet Serienummer ondersteunen)

### wijziging uitvoering
- [ ] Werk device_identifiers.product_version_id bij (huidige productversie)
- [ ] Behoud delivery_product_version_id (oorspronkelijke levering blijft intact)
- [ ] Creëer entry in product_version_history tabel:
  - device_identifier_id
  - old_product_version_id
  - new_product_version_id
  - changed_by (huidige gebruiker)
  - note (optionele reden)
  - timestamp

### geschiedenis weergave
- [ ] Productversie Geschiedenis sectie op detailpagina
- [ ] Tabel met alle versie wijzigingen:
  - Datum/Tijd
  - Oude Productversie → Nieuwe Productversie
  - Gewijzigd Door
  - Reden/Notitie
- [ ] Links naar zowel oude als nieuwe productversie detailpagina's

### bedrijfsregels
- [ ] IMEI en serienummers blijven ongewijzigd
- [ ] Apparaat status blijft ongewijzigd
- [ ] Levering registratie is immutable (delivery_id en oorspronkelijke productversie)
- [ ] Leveringsdetails reflecteren altijd wat daadwerkelijk geleverd werd
- [ ] Huidige productversie kan afwijken van geleverde productversie
- [ ] Alle wijzigingen worden permanent gelogd als post-delivery correcties
- [ ] Inkooporder koppelingen blijven gekoppeld aan oorspronkelijke leveringsdata
- [ ] Gebruiker moet geautoriseerd zijn om wijzigingen uit te voeren

### impact waarschuwingen
- [ ] Toon compatibiliteitscontrole resultaten
- [ ] Waarschuw voor mogelijke inkooporder impacts
- [ ] Bevestig tracking modus wijzigingen
- [ ] Toon samenvatting van wat er zal wijzigen

### gebruikersinterface vereisten
- [ ] Duidelijke interface met oude vs nieuwe productversie
- [ ] Dropdown gefilterd om alleen compatibele versies te tonen
- [ ] Validatie berichten voor incompatibele selecties
- [ ] Bevestigingsdialoog met impact samenvatting
- [ ] Succesbericht met bijgewerkte informatie

### leveringspagina integratie
- [ ] Rood pijl icoon (→) tonen na identifier die een productversie swap heeft ondergaan
- [ ] Icoon wordt getoond direct na IMEI of serienummer zonder extra tekst
- [ ] Hover tooltip toont: "Productversie gewijzigd na levering naar: [nieuwe versie]"
- [ ] Leveringsdetail blijft oorspronkelijke geleverde productversie tonen (immutable)
- [ ] Geen onnodige productversie tekst of labels op leveringspagina
- [ ] Minimalistisch ontwerp: alleen identifier + alert icoon
- [ ] Leveringsstatistieken blijven gebaseerd op oorspronkelijke productversies

### randgevallen
- [ ] Behandel situatie als nieuwe productversie later wordt verwijderd
- [ ] Toon historische productversie namen ook als verwijderd
- [ ] Voorkom circulaire swaps of excessieve swap geschiedenis

STORY POINTS: 6
PRIORITY: Medium (Correction functionality)  
DEPENDENCIES: 007-identifier-swap